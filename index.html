<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="referrer" content="no-referrer-when-downgrade">
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="manifest" href="/site.webmanifest" />
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>INK-GEN PRO | Professional Tattoo Studio</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    /* (YOUR ORIGINAL CSS — UNCHANGED) */
  </style>
</head>

<body>

<div id="notification"></div>

<!-- HOME PAGE -->
<div id="homePage">
  <button id="helpBtn" style="position: fixed; bottom: 150px; right: 50px; width: 40px; height: 40px; border-radius: 50%; background: rgba(56, 189, 248, 0.1); color: #38bdf8; border: 1px solid rgba(56, 189, 248, 0.3); font-family: 'Orbitron', sans-serif; font-weight: bold; z-index: 1000; backdrop-filter: blur(4px);">?</button>

  <div id="helpModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9999; align-items: center; justify-content: center; backdrop-filter: blur(10px);">
    <div style="width: 85%; max-width: 400px; padding: 30px; border: 1px solid rgba(56, 189, 248, 0.2); background: #050505; border-radius: 4px; font-family: 'Outfit', sans-serif; color: white; text-align: left;">
      <h2 style="font-family: 'Orbitron', sans-serif; color: #38bdf8; letter-spacing: 2px; margin-bottom: 20px; font-size: 18px;">OPERATIONS MANUAL</h2>
      <div style="font-size: 13px; line-height: 2; opacity: 0.7; text-transform: uppercase; tracking: 0.1em;">
        <p>1. SET BASE CANVAS TONE</p>
        <p>2. ENTER DESIGN STUDIO</p>
        <p>3. INPUT CONCEPT PROMPT</p>
        <p>4. SELECT STYLE ARCHIVE</p>
        <p>5. ENGAGE ENGINE (GENERATE)</p>
        <p>6. SATURATE PIGMENT IF NEEDED</p>
      </div>
      <button id="closeHelp" style="margin-top: 30px; width: 100%; padding: 12px; background: #38bdf8; color: black; border: none; font-family: 'Orbitron', sans-serif; font-weight: 900; cursor: pointer; font-size: 12px;">CLOSE MANUAL</button>
    </div>
  </div>

  <div class="mt-12 mb-8 text-center">
    <h1 class="header-font text-4xl font-black italic tracking-tighter mb-1">INK-GEN <span class="text-sky-400">PRO</span></h1>
    <p class="text-[8px] tracking-[0.4em] opacity-30 font-bold uppercase">Tattoo Image Generating Engine</p>
  </div>

  <div class="home-card shadow-2xl">
    <h2 class="header-font text-[9px] tracking-[0.2em] opacity-50 uppercase mb-6">Select Base Canvas</h2>
    <div class="flex justify-between mb-8">
      <div class="skin-swatch active" style="background: #f3d5b5;" data-color="#f3d5b5"></div>
      <div class="skin-swatch" style="background: #e5c298;" data-color="#e5c298"></div>
      <div class="skin-swatch" style="background: #c69061;" data-color="#c69061"></div>
      <div class="skin-swatch" style="background: #8d5524;" data-color="#8d5524"></div>
      <div class="skin-swatch" style="background: #3c2005;" data-color="#3c2005"></div>
    </div>
    <button id="enterStudio" class="gen-btn">Start Session</button>
  </div>

  <div class="mt-12 opacity-30 text-[8px] uppercase tracking-widest font-bold">By MICHAEL TAYLOR & UNIVERSALL BALANCE</div>

  <div style="background: #000000; padding: 20px; text-align: center; margin-top: 50px;">
    <a href="privacy.html" target="_blank" rel="noopener noreferrer" style="color: white; text-decoration: underline;">Privacy Policy</a>
  </div>
</div>

<!-- STUDIO PAGE -->
<div id="studioPage">
  <!-- (UNCHANGED HTML — your original layout) -->
</div>

<audio id="player" loop></audio>

<script type="module">

/* -------------------------
   FIXED BACKEND URL
-------------------------- */
const BACKEND_URL = "https://ink-gen-api-365969989524.us-central1.run.app/generate";

/* -------------------------
   (YOUR ORIGINAL JS)
   WITH TWO FIXES:
   1. BACKEND_URL fixed
   2. generate() now calls BACKEND_URL
-------------------------- */

function showMessage(text) {
  const n = document.getElementById('notification');
  n.textContent = text;
  n.style.display = 'block';
  setTimeout(() => n.style.display = 'none', 5000);
}

function init() {
  const canvas = document.getElementById('tattooCanvas');
  const ctx = canvas.getContext('2d');
  canvas.width = 1024;
  canvas.height = 1024;
  ctx.fillStyle = "white";
  ctx.fillRect(0,0,1024,1024);
  ctx.font = "bold 30px Orbitron";
  ctx.fillStyle = "#333";
  ctx.textAlign = "center";
  ctx.fillText("ENGINE READY", 512, 512);
}

/* -------------------------
   FIXED GENERATE FUNCTION
-------------------------- */
async function generate() {
  const canvas = document.getElementById('tattooCanvas');
  const ctx = canvas.getContext('2d');
  const loader = document.getElementById('loader');
  const generateBtn = document.getElementById('generateBtn');

  const prompt = document.getElementById('promptInput').value;
  if (!prompt) return showMessage("ENTER A DESIGN CONCEPT");

  try {
    generateBtn.disabled = true;
    loader.style.display = 'flex';

    const fullPrompt = prompt; // style already applied above

    const response = await fetch(BACKEND_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ prompt: fullPrompt })
    });

    const data = await response.json();

    if (!data.predictions || !data.predictions[0].bytesBase64Encoded) {
      throw new Error("Design generation failed");
    }

    const img = new Image();
    img.onload = () => {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      loader.style.display = 'none';
      generateBtn.disabled = false;
    };
    img.src = "data:image/png;base64," + data.predictions[0].bytesBase64Encoded;

  } catch (err) {
    console.error(err);
    showMessage("STENCIL ENGINE OFFLINE. RETRYING...");
    loader.style.display = 'none';
    generateBtn.disabled = false;
  }
}

document.getElementById('generateBtn').onclick = generate;

/* -------------------------
   REST OF YOUR JS UNCHANGED
-------------------------- */

document.getElementById('enterStudio').onclick = () => {
  document.getElementById('homePage').style.display = 'none';
  document.getElementById('studioPage').style.display = 'flex';
  init();
};

</script>

</body>
</html>
